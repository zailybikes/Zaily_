(window.agentWebpackJsonp=window.agentWebpackJsonp||[]).push([[20],{524:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(143),n=n(a(203)),a=a(622),a=(0,o.connect)(function(e){return e})((0,n.default)(a.Advert,"Advert"));t.default=a},622:function(e,t,a){"use strict";var n=a(1);Object.defineProperty(t,"__esModule",{value:!0}),t.Advert=void 0;var i=n(a(57)),o=n(a(58)),c=n(a(204)),r=n(a(141)),d=n(a(142)),s=n(a(97)),l=n(a(9)),u=n(a(23)),v=n(a(19)),f=a(15),h=a(11),p=a(17),m=n(a(14)),g=a(69),_=a(68),y=a(27);function w(a){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=(0,s.default)(a);return t=n?(e=(0,s.default)(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),(0,d.default)(this,t)}}var E=!1,A="",a=function(e){(0,r.default)(a,e);var t=w(a);function a(e){var o;return(0,i.default)(this,a),o=t.call(this,e),(0,l.default)((0,c.default)(o),"handleMouseUp",function(){A=location.href;function e(){A!==location.href&&(A=location.href,o.handleHashChange())}setTimeout(function(){window.requestAnimationFrame?requestAnimationFrame(e):e()},500)}),(0,l.default)((0,c.default)(o),"handleClick",function(e){e.preventDefault();var t=o.props.dispatch,a=o.props.agentConfig,n=o.getAd(),e={id:a.user.id,type:1};t((0,y.openWindow)()),t((0,y.sendMessage)(n.question,e,a.app.id)),t((0,y.setAdvertClick)(n.id)),o.setState({clicked:!0})}),(0,l.default)((0,c.default)(o),"handleClose",function(e){e.preventDefault(),e.stopPropagation(),o.setState({clicked:!0})}),(0,l.default)((0,c.default)(o),"handleDragStart",function(e){e.preventDefault()}),(0,l.default)((0,c.default)(o),"handleOnLoad",function(e){e.preventDefault()}),(0,l.default)((0,c.default)(o),"handleHashChange",function(){o.update(),o.setState({clicked:!1}),o.runAdvert()}),o.state={clicked:!1},o}return(0,o.default)(a,[{key:"componentDidMount",value:function(){window.addEventListener("hashchange",this.handleHashChange),document.body&&document.body.addEventListener("mouseup",this.handleMouseUp),this.runAdvert()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("hashchange",this.handleHashChange),document.body&&document.body.removeEventListener("mouseup",this.handleMouseUp)}},{key:"runAdvert",value:function(){var t,e,a,n,o=this.props,i=o.dispatch,c=o.agentConfig,r=m.default.getHeight,d=m.default.searchInsideShadowRoot,s=d(".".concat(h.KEY__ADVERT));function l(e){for(var t,a,n=parseInt(e.style.fontSize.replace("px",""));135<r(e)&&1<n;)e.style.fontSize="".concat(n-=1,"px"),t=a=t=void 0,t=d(".aivochat-advert-content"),a=d(".aivochat-advert-text"),t=r(t),(a=r(a))<t&&(a=(t-a)/2,d(".aivochat-advert-text")[0].style.top=a)}0<s.length&&((t=this.getAd())&&(e=1e3*parseInt(t.delay),a=2147483637,o=0<=(n=location.href).indexOf("https://")?8:7,n=location.href.substring(o,location.href.length),"*"!==t.host.substring(t.host.length-1)?n===t.host&&(s[0].classList.remove("show"),setTimeout(function(){var e;s[0].classList.add("show"),E||(i((0,y.setAdvertView)(t.id)),E=!0,(0,p.bringToFront)(".".concat(h.KEY__ADVERT),a.toString()),window[h.KEY__SDK]._onShowAdvert&&window[h.KEY__SDK]._onShowAdvert(),e=[{action:"advert_id",param:t.id},{action:"event_type",param:"showAd-chat"},{action:"event_label",param:"show advert"}],(0,_.setEventAnalytics)(c.user.id,c.app.id,window.navigator.userAgent,e))},e)):0<=n.indexOf(t.host.substring(0,t.host.length-2))&&(s[0].classList.remove("show"),setTimeout(function(){var e;s[0].classList.add("show"),E||(i((0,y.setAdvertView)(t.id)),E=!0,(0,p.bringToFront)(".".concat(h.KEY__ADVERT),a.toString()),window[h.KEY__SDK]._onShowAdvert&&window[h.KEY__SDK]._onShowAdvert(),e=[{action:"advert_id",param:t.id},{action:"event_type",param:"showAd-chat"},{action:"event_label",param:"show advert"}],(0,_.setEventAnalytics)(c.user.id,c.app.id,window.navigator.userAgent,e))},e)),1===parseInt(t.proactivity_type_id)&&(d(".aivochat-advert-close")[0].classList.add("aivochat-advert.show"),d(".aivochat-advert-close")[0].classList.remove("aivochat-advert.hide"),setTimeout(function(){l(d(".aivochat-advert-text")[0])},e))))}},{key:"getAd",value:function(){var e=this.props.agentConfig;return e.proactivities?e.proactivities[0]:void 0}},{key:"update",value:function(){var t=this,e=this.props,a=e.agentConfig,n=e.dispatch;(0,g.isSandbox)()||m.default.getSettings(a.app.id,function(e){e.proactivity&&e.proactivities&&(E=!1,t.setState({clicked:!1}),n((0,y.setConfig)({proactivities:e.proactivities})))})}},{key:"render",value:function(){var t=this,a=this.getAd(),n=function(e){switch(parseInt(e)){case 1:return u.default.createElement("div",{className:"aivochat-advert-content",style:{backgroundColor:a.color_background}},u.default.createElement("div",{className:"aivochat-advert-padding"},u.default.createElement("div",{className:"aivochat-advert-text",style:{color:a.color}},"".concat(a.welcome_message))),u.default.createElement("div",{className:"aivochat-advert-corner ".concat(a.image_location),style:{borderBottomColor:a.color_background}}),u.default.createElement("div",{className:"aivochat-advert-close",style:{color:a.color},onClick:t.handleClose},u.default.createElement("i",{className:"material-icons"},"close")));case 2:return u.default.createElement("div",{className:"aivochat-advert-content"},u.default.createElement("img",{className:"aivochat-advert-image",src:(0,g.isURL)(a.image_url)?a.image_url:"".concat(f.Mx728ZM,"/").concat(a.image_url),onLoad:t.handleOnLoad,onDragStart:t.handleDragStart}),u.default.createElement("div",{className:"aivochat-advert-close",style:{color:a.color},onClick:t.handleClose},u.default.createElement("i",{className:"material-icons"},"close")),u.default.createElement("div",{className:"aivochat-advert-padding"}));default:return u.default.createElement("div",null)}};return u.default.createElement("div",null,function(){if(!t.state.clicked&&void 0!==a&&void 0!==a.proactivity_type_id){var e=1===parseInt(a.proactivity_type_id)?"text":"image";return u.default.createElement("div",{className:"".concat(h.KEY__ADVERT," ").concat(e," ").concat(a.image_location),onClick:t.handleClick},n(a.proactivity_type_id))}}())}}]),a}(u.default.Component);(t.Advert=a).propTypes={agentConfig:v.default.object,dispatch:v.default.func}}}]);